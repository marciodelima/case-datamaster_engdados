executor: KubernetesExecutor

airflow:
  image:
    repository: apache/airflow
    tag: 2.9.3
  config:
    AIRFLOW__CORE__FERNET_KEY: _agpsPrbStaDK78nsbuA__yLffauxKiIhSICmYL7tm8=
    AIRFLOW__KUBERNETES__NAMESPACE: airflow
    AIRFLOW__KUBERNETES__WORKER_CONTAINER_IMAGE: apache/airflow:2.9.3

  extraContainers:
    - name: filebeat
      image: docker.elastic.co/beats/filebeat:8.12.0
      volumeMounts:
        - name: logs
          mountPath: /opt/airflow/logs
        - name: filebeat-config
          mountPath: /usr/share/filebeat/filebeat.yml
          subPath: filebeat.yml
      command: ["filebeat", "-e", "-c", "/usr/share/filebeat/filebeat.yml"]

  extraVolumes:
    - name: logs
      persistentVolumeClaim:
        claimName: airflow-logs-pvc
    - name: filebeat-config
      configMap:
        name: filebeat-config

webserver:
  enabled: true
  service:
    type: ClusterIP
    port: 8080
  defaultUser:
    enabled: true
    username: admin
    password: admin
  resources:
    requests:
      cpu: "500m"
      memory: "1Gi"

scheduler:
  resources:
    requests:
      cpu: "500m"
      memory: "1Gi"

dags:
  persistence:
    enabled: true
    existingClaim: airflow-dags-pvc

extraVolumeMounts:
  - name: spark-yaml
    mountPath: /opt/spark/yaml
    readOnly: true

extraVolumes:
  - name: spark-yaml
    persistentVolumeClaim:
      claimName: spark-yaml-pvc

metrics:
  enabled: true
  exporter:
    enabled: true
    image:
      repository: epoch8/airflow-exporter
      tag: latest
    serviceMonitor:
      enabled: true
      labels:
        release: prometheus

